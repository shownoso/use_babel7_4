### 垫片
为了观察结果，搭建webpack环境...
### 发现问题
src/index.js
```js
Promise.resolve().finally();
```
- 上述代码无法转换 Edge 17： Object doesn't support property or method 'finally'
- 之前的处理只能转换语法，不能添加浏览器本不存在的对象或者原型方法

### 使用垫片
安装垫片，注意：@babel/polyfill在babel7.4后废弃，这里只作为演示
```bash
# 因为是垫片，增添的功能需要被加入，因此作为依赖
npm install -S @babel/polyfill
```
修改 src/index.js 
```js
// 直接在入口一次性引入
import '@babel/polyfill';
Promise.resolve().finally();
```
- Edge 17 不再报错，polyfill成功
- 但是，因为默认引入所有的es扩展包，打包结果很大

#### 关于@babel/polyfill的废弃
babel7.4后, 使用core-js和regenerator-runtimej进行替代  
```bash
npm i -S core-js regenerator-runtime
```
src/index.js
```js
import "core-js/stable"; 
import "regenerator-runtime/runtime";
Promise.resolve().finally();
```
- 重新打包，效果等价


### 使用preset-env 的 useBuiltIns 处理垫片结果
useBuiltIns的三个选项：
- entry：preset-env使用垫片，需要在入口引入所有的es扩展包
- usage：preset-env使用垫片，按需引入es扩展包
- false：默认值，preset-env只关注转换
```entry 或者 usage 的情况下，需要为 preset-env 指定core-js的版本,默认为2```
```bash
npm i -S core-js
```
##### useBuiltIns: entry
修改 babel.config.js
```js
[
  "@babel/env",
  {
    useBuiltIns: 'entry',
    corejs: 3
  },
],
```
src/index.js
```js
import "core-js/stable"; // 垫片需要打包进源码
//import "regenerator-runtime/runtime"; // preset-env内置了regenerator-runtime
```
- 转换成功了，包体积依然很大
##### useBuiltIns: usage
修改 babel.config.js
```js
[
  "@babel/env",
  {
    useBuiltIns: 'usage',
    corejs: 3
  },
],
```
src/index.js
```js
// 无需手动引入
//import "core-js/stable"; 
//import "regenerator-runtime/runtime";
```
- 转换成功了，自动按需引入

### 小结
- 垫片处理需要core-js和regenerator-runtime
- 当使用preset-env时，需要制定core-js版本
- preset-env内置了regenerator-runtime
  - useBuiltIns为 entry 时，在入口顶部引入core-js作为拓展包的依赖，因此会一次性引入所有的拓展包
  - useBuiltIns为 usage 时，无需在入口引入core-js，preset-env会自动按需引入需要的拓展包，但是可能会出现引入第三方的代码包未注入模块而引发bug，所以要选择信赖的包